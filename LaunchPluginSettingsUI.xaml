<UserControl x:Class="LaunchPlugin.LaunchPluginSettingsUI"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:LaunchPlugin"
             xmlns:styles="clr-namespace:SimHub.Plugins.Styles;assembly=SimHub.Plugins"
             xmlns:ui="clr-namespace:SimHub.Plugins.UI;assembly=SimHub.Plugins"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800"
             x:Name="SettingsPage">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="10">

            <styles:SHSection Title="LAUNCH PARAMETERS" ShowSeparator="True">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="5,0,0,10">
                        <TextBlock Text="{Binding ActiveProfile.ProfileName, StringFormat='Current Profile: {0}'}"
                                   HorizontalAlignment="Left" FontSize="13" Foreground="DarkGray" VerticalAlignment="Center" />

                        <styles:SHButtonPrimary Content="Save to Profile" Margin="15,0,0,0"
                                                Command="{Binding SaveActiveProfileCommand}"
                                                Visibility="{Binding IsActiveProfileDirty, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                        <styles:SHButtonPrimary Content="Return to Defaults" Margin="5,0,0,0"
                                                Command="{Binding ReturnToDefaultsCommand}"
                                                ToolTip="Resets the view to the 'Default Settings' profile."
                                                Visibility="{Binding CanReturnToDefaults, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    </StackPanel>
                    <ui:TitledSlider Title="Target Launch RPM" Minimum="1000" Maximum="10000" Value="{Binding ActiveProfile.TargetLaunchRPM, Mode=TwoWay}" ToolTip="Set your ideal engine speed for the moment the clutch bites."/>
                    <ui:TitledSlider Title="Optimal RPM Tolerance" Minimum="100" Maximum="2000" Value="{Binding ActiveProfile.OptimalRPMTolerance, Mode=TwoWay}" />
                    <ui:TitledSlider Title="Target Launch Throttle (%)" Minimum="1" Maximum="100" Value="{Binding ActiveProfile.TargetLaunchThrottle, Mode=TwoWay}" ToolTip="Set your ideal throttle for the moment the clutch bites."/>
                    <ui:TitledSlider Title="Optimal Throttle Tolerance (%)" Minimum="0" Maximum="20" Value="{Binding ActiveProfile.OptimalThrottleTolerance, Mode=TwoWay}" />
                    <ui:TitledSlider Title="Target Bite Point (%)" Minimum="0" Maximum="100" Value="{Binding ActiveProfile.TargetBitePoint, Mode=TwoWay}" ToolTip="Set this to match your wheel setting for bite point."/>
                    <ui:TitledSlider Title="Bite Point Tolerance (%)" Minimum="1" Maximum="10" Value="{Binding ActiveProfile.BitePointTolerance, Mode=TwoWay}" />
                    <ui:TitledSlider Title="Bog Down Factor (%)" Minimum="0" Maximum="100" Value="{Binding ActiveProfile.BogDownFactorPercent, Mode=TwoWay}" ToolTip="If the engine RPM drops below this percentage of the initial Launch RPM, the run will be flagged as 'Bogged'."/>
                    <ui:TitledSlider Title="Anti-Stall Alert Threshold (%)" Minimum="0" Maximum="100" Value="{Binding ActiveProfile.AntiStallThreshold, Mode=TwoWay}" ToolTip="Sets the sensitivity for detecting game-assisted anti-stall. % is delta between paddle and in game clutch."/>
                </StackPanel>
            </styles:SHSection>

            <styles:SHSection Title="TELEMETRY LOGGING SETTINGS" ShowSeparator="True">
                <StackPanel>
                    <TextBlock Margin="0,5,0,2" Foreground="LightGray">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}Main Summary CSV Path (Leave blank for default: {0})">
                                <Binding ElementName="SettingsPage" Path="DefaultSummaryLogPath" Mode="OneWay"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <styles:SHToggleCheckbox Grid.Column="0" VerticalAlignment="Center" Margin="0,0,10,0"
                                                 IsChecked="{Binding Settings.EnableCsvLogging, Mode=TwoWay}"
                                                 ToolTip="Enable or disable writing the one-line summary of each launch."/>
                        <TextBox Grid.Column="1" x:Name="CsvPathTextBox" 
                                 Text="{Binding Settings.CsvLogPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                 VerticalAlignment="Center" />
                        <styles:SHButtonPrimary Grid.Column="2" Content="Browse..." Margin="5,0,0,0"
                                                Tag="{Binding ElementName=CsvPathTextBox}" Click="BrowseButton_Click"/>
                    </Grid>
                    <TextBlock Margin="0,15,0,2" Foreground="LightGray">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}Detailed Trace Files Path (Leave blank for default: {0})">
                                <Binding ElementName="SettingsPage" Path="DefaultTraceLogPath" Mode="OneWay"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <styles:SHToggleCheckbox Grid.Column="0" VerticalAlignment="Center" Margin="0,0,10,0"
                                                 IsChecked="{Binding Settings.EnableTelemetryTracing, Mode=TwoWay}"
                                                 ToolTip="Enable or disable creating detailed trace files for the 'LAUNCH ANALYSIS' tab."/>
                        <TextBox Grid.Column="1" x:Name="TracePathTextBox" 
                                 Text="{Binding Settings.TraceLogPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                 VerticalAlignment="Center" />
                        <styles:SHButtonPrimary Grid.Column="2" Content="Browse..." Margin="5,0,0,0" 
                                                Tag="{Binding ElementName=TracePathTextBox}" Click="BrowseButton_Click"/>
                    </Grid>
                    <styles:SHToggleCheckbox Content="Enable Debug Logging" Margin="0,20,0,0"
                                             IsChecked="{Binding Settings.EnableDebugLogging, Mode=TwoWay}" 
                                             ToolTip="Enables verbose logging for troubleshooting the plugin."/>
                </StackPanel>
            </styles:SHSection>
        </StackPanel>
    </ScrollViewer>
</UserControl>