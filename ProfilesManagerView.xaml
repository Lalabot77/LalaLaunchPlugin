<UserControl x:Class="LaunchPlugin.ProfilesManagerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:styles="clr-namespace:SimHub.Plugins.Styles;assembly=SimHub.Plugins"
             xmlns:ui="clr-namespace:SimHub.Plugins.UI;assembly=SimHub.Plugins"
             xmlns:local="clr-namespace:LaunchPlugin"  
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    <UserControl.Resources>
    </UserControl.Resources>
    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250" MinWidth="200" />
            <ColumnDefinition Width="10" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <DockPanel Grid.Column="0">
            <TextBlock DockPanel.Dock="Top" Text="Car Profiles Library" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
            <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                <styles:SHButtonPrimary Content="New" Width="70" Margin="2" Command="{Binding NewProfileCommand}"/>
                <styles:SHButtonPrimary Content="Copy To..." Width="80" Margin="2" Command="{Binding CopySettingsCommand}"/>
                <styles:SHButtonSecondary Content="Delete" Width="70" Margin="2" Command="{Binding DeleteProfileCommand}" Background="#C82333" Foreground="White"/>
            </StackPanel>
            <ListBox ItemsSource="{Binding SortedCarProfiles}" SelectedItem="{Binding SelectedProfile, Mode=TwoWay}" DisplayMemberPath="ProfileName" BorderThickness="1" BorderBrush="Gray"/>
        </DockPanel>

        <DockPanel Grid.Column="2" IsEnabled="{Binding IsProfileSelected}">
            <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,10">
                <TextBlock Text="Editing Profile:" FontSize="16" FontWeight="Bold" VerticalAlignment="Center"/>
                <TextBox Text="{Binding SelectedProfile.ProfileName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                         FontSize="16" FontWeight="Normal" Margin="10,0,0,0" MinWidth="200"
                         BorderThickness="0" Background="Transparent"/>
            </StackPanel>
            <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                <styles:SHButtonPrimary Content="Apply to Live Session" Width="150" Margin="0,0,10,0" Command="{Binding ApplyToLiveCommand}" Height="30"
                                        ToolTip="Instantly copies these settings to the active car for this session."/>
                <styles:SHButtonPrimary Content="Save All Changes" Width="150" Command="{Binding SaveChangesCommand}" Height="30"
                                        ToolTip="Saves all profiles to the JSON file."/>
            </StackPanel>

            <TabControl>
                <styles:SHTabItem Header="DASH">
                    <StackPanel Margin="10" DataContext="{Binding SelectedProfile}">

                        <ui:TitledSlider Title="Rejoin Assist Linger Time (sec)"
                         Minimum="1" Maximum="30"
                         Value="{Binding RejoinWarningLingerTime, Mode=TwoWay}">
                            <ui:TitledSlider.ToolTip>
                                <ToolTip>
                                    <TextBlock Text="How long the rejoin warning remains visible after returning to the track (in seconds)." TextWrapping="Wrap" Width="240"/>
                                </ToolTip>
                            </ui:TitledSlider.ToolTip>
                        </ui:TitledSlider>

                        <ui:TitledSlider Title="Rejoin Assist Clear Speed (kph)"
                         Minimum="10" Maximum="250"
                         Value="{Binding RejoinWarningMinSpeed, Mode=TwoWay}">
                            <ui:TitledSlider.ToolTip>
                                <ToolTip>
                                    <TextBlock Text="The minimum speed (in km/h) above which the rejoin warning automatically clears." TextWrapping="Wrap" Width="240"/>
                                </ToolTip>
                            </ui:TitledSlider.ToolTip>
                        </ui:TitledSlider>

                        <ui:TitledSlider Title="Spin Yaw Rate Threshold"
                         Minimum="10" Maximum="100"
                         Value="{Binding SpinYawRateThreshold, Mode=TwoWay}">
                            <ui:TitledSlider.ToolTip>
                                <ToolTip>
                                    <TextBlock Text="Yaw rate (degrees per second) above which a spin event is detected and triggers rejoin assist." TextWrapping="Wrap" Width="240"/>
                                </ToolTip>
                            </ui:TitledSlider.ToolTip>
                        </ui:TitledSlider>

                        <ui:TitledSlider Title="Overtake Alert Time (sec)"
                         Minimum="1" Maximum="20"
                         Value="{Binding TrafficApproachWarnSeconds, Mode=TwoWay}">
                            <ui:TitledSlider.ToolTip>
                                <ToolTip>
                                    <TextBlock Text="How many seconds behind an approaching car must be projected to trigger the overtake alert." TextWrapping="Wrap" Width="240"/>
                                </ToolTip>
                            </ui:TitledSlider.ToolTip>
                        </ui:TitledSlider>

                        <ui:TitledSlider Title="Pit Entry Decel (m/s²)"
                         Minimum="8" Maximum="22"
                         Value="{Binding PitEntryDecelMps2, Mode=TwoWay}">
                            <ui:TitledSlider.ToolTip>
                                <ToolTip>
                                    <TextBlock Text="Target deceleration for pit entry braking assist (m/s²)." TextWrapping="Wrap" Width="240"/>
                                </ToolTip>
                            </ui:TitledSlider.ToolTip>
                        </ui:TitledSlider>

                        <ui:TitledSlider Title="Pit Entry Buffer (m)"
                         Minimum="0" Maximum="40"
                         Value="{Binding PitEntryBufferM, Mode=TwoWay}">
                            <ui:TitledSlider.ToolTip>
                                <ToolTip>
                                    <TextBlock Text="Distance before the pit entry trigger point to start the braking assist." TextWrapping="Wrap" Width="240"/>
                                </ToolTip>
                            </ui:TitledSlider.ToolTip>
                        </ui:TitledSlider>

                    </StackPanel>
                </styles:SHTabItem>


                <styles:SHTabItem Header="LAUNCH">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="10" DataContext="{Binding SelectedProfile}">

                            <ui:TitledSlider Title="Target Launch RPM"
                             Minimum="1000" Maximum="10000"
                             Value="{Binding TargetLaunchRPM, Mode=TwoWay}">
                                <ui:TitledSlider.ToolTip>
                                    <ToolTip>
                                        <TextBlock Text="The target engine RPM to hold during launch control activation." TextWrapping="Wrap" Width="240"/>
                                    </ToolTip>
                                </ui:TitledSlider.ToolTip>
                            </ui:TitledSlider>

                            <ui:TitledSlider Title="Optimal RPM Tolerance"
                             Minimum="100" Maximum="2000"
                             Value="{Binding OptimalRPMTolerance, Mode=TwoWay}">
                                <ui:TitledSlider.ToolTip>
                                    <ToolTip>
                                        <TextBlock Text="Allowed deviation (±RPM) from the target launch RPM before the system flags it as out of range." TextWrapping="Wrap" Width="240"/>
                                    </ToolTip>
                                </ui:TitledSlider.ToolTip>
                            </ui:TitledSlider>

                            <ui:TitledSlider Title="Target Launch Throttle (%)"
                             Minimum="1" Maximum="100"
                             Value="{Binding TargetLaunchThrottle, Mode=TwoWay}">
                                <ui:TitledSlider.ToolTip>
                                    <ToolTip>
                                        <TextBlock Text="Throttle percentage to apply when holding the launch RPM target." TextWrapping="Wrap" Width="240"/>
                                    </ToolTip>
                                </ui:TitledSlider.ToolTip>
                            </ui:TitledSlider>

                            <ui:TitledSlider Title="Optimal Throttle Tolerance (%)"
                             Minimum="0" Maximum="20"
                             Value="{Binding OptimalThrottleTolerance, Mode=TwoWay}">
                                <ui:TitledSlider.ToolTip>
                                    <ToolTip>
                                        <TextBlock Text="Accepted throttle percentage deviation from target before launch control gives a warning." TextWrapping="Wrap" Width="240"/>
                                    </ToolTip>
                                </ui:TitledSlider.ToolTip>
                            </ui:TitledSlider>

                            <ui:TitledSlider Title="Target Bite Point (%)"
                             Minimum="0" Maximum="100"
                             Value="{Binding TargetBitePoint, Mode=TwoWay}">
                                <ui:TitledSlider.ToolTip>
                                    <ToolTip>
                                        <TextBlock Text="Clutch engagement percentage considered the ideal bite point for launch." TextWrapping="Wrap" Width="240"/>
                                    </ToolTip>
                                </ui:TitledSlider.ToolTip>
                            </ui:TitledSlider>

                            <ui:TitledSlider Title="Bite Point Tolerance (%)"
                             Minimum="1" Maximum="10"
                             Value="{Binding BitePointTolerance, Mode=TwoWay}">
                                <ui:TitledSlider.ToolTip>
                                    <ToolTip>
                                        <TextBlock Text="Allowed deviation (±%) around the target bite point during launch setup." TextWrapping="Wrap" Width="240"/>
                                    </ToolTip>
                                </ui:TitledSlider.ToolTip>
                            </ui:TitledSlider>

                            <ui:TitledSlider Title="Bog Down Factor (%)"
                             Minimum="0" Maximum="100"
                             Value="{Binding BogDownFactorPercent, Mode=TwoWay}">
                                <ui:TitledSlider.ToolTip>
                                    <ToolTip>
                                        <TextBlock Text="Launch performance reduction factor to simulate clutch bog or wheel slip." TextWrapping="Wrap" Width="240"/>
                                    </ToolTip>
                                </ui:TitledSlider.ToolTip>
                            </ui:TitledSlider>

                            <ui:TitledSlider Title="Anti-Stall Alert Threshold (%)"
                             Minimum="0" Maximum="100"
                             Value="{Binding AntiStallThreshold, Mode=TwoWay}">
                                <ui:TitledSlider.ToolTip>
                                    <ToolTip>
                                        <TextBlock Text="Throttle or clutch percentage threshold below which an anti-stall warning is triggered." TextWrapping="Wrap" Width="240"/>
                                    </ToolTip>
                                </ui:TitledSlider.ToolTip>
                            </ui:TitledSlider>

                        </StackPanel>
                    </ScrollViewer>
                </styles:SHTabItem>


                <styles:SHTabItem Header="FUEL">
                    <StackPanel Margin="10" DataContext="{Binding SelectedProfile}">
                        <ui:TitledSlider Title="Contingency Laps/Litres" Minimum="0" Maximum="10" Value="{Binding FuelContingencyValue, Mode=TwoWay}" />
                        <styles:SHToggleCheckbox Content="Contingency is in Laps (otherwise Litres)" IsChecked="{Binding IsContingencyInLaps, Mode=TwoWay}" Margin="5,10,0,0"/>
                        <ui:TitledSlider Title="Wet Fuel Multiplier (%)" Minimum="70" Maximum="130" Value="{Binding WetFuelMultiplier, Mode=TwoWay}" Margin="0,15,0,0"/>

                        <Grid Margin="0,15,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Text="Race Pace Delta (seconds):" ToolTip="How many seconds slower your average race pace is compared to your personal best lap (e.g., 1.2)."/>
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Slider Grid.Column="0" VerticalAlignment="Center" Value="{Binding RacePaceDeltaSeconds, Mode=TwoWay}" Minimum="0" Maximum="5" SmallChange="0.1" TickFrequency="0.1" IsSnapToTickEnabled="True" />
                                <TextBlock Grid.Column="1" Text="{Binding RacePaceDeltaSeconds, StringFormat=N1}" VerticalAlignment="Center" Margin="10,0,0,0" MinWidth="35" TextAlignment="Right"/>
                            </Grid>
                        </Grid>

                        <Grid Margin="0,15,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Text="Refuel Rate (L/s):" ToolTip="The average rate at which the car refuels."/>
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Slider Grid.Column="0" VerticalAlignment="Center" Value="{Binding RefuelRate, Mode=TwoWay}" Minimum="1" Maximum="10" SmallChange="0.05" TickFrequency="0.05" IsSnapToTickEnabled="True" />
                                <TextBlock Grid.Column="1" Text="{Binding RefuelRate, StringFormat=N2}" VerticalAlignment="Center" Margin="10,0,0,0" MinWidth="35" TextAlignment="Right"/>
                            </Grid>
                        </Grid>
                    </StackPanel>
                </styles:SHTabItem>

                <styles:SHTabItem Header="TRACKS">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="200" MinWidth="180" />
                            <ColumnDefinition Width="10" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <DockPanel Grid.Column="0">
                            <TextBlock DockPanel.Dock="Top" Text="Recorded Tracks" FontWeight="Bold" Margin="0,0,0,10"/>
                            <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                                <styles:SHButtonSecondary Content="Delete" Width="80" Command="{Binding DeleteTrackCommand}" Background="#C82333" Foreground="White"/>
                            </StackPanel>
                            <ListBox ItemsSource="{Binding TracksForSelectedProfile}" SelectedItem="{Binding SelectedTrack, Mode=TwoWay}" DisplayMemberPath="DisplayName" BorderThickness="1" BorderBrush="Gray"/>
                        </DockPanel>

                        <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <StackPanel DataContext="{Binding SelectedTrack}" Grid.IsSharedSizeScope="True" IsEnabled="{Binding DataContext.IsTrackSelected, RelativeSource={RelativeSource AncestorType=UserControl}}">
                                <TextBlock FontWeight="Bold">
                                    <Run Text="Editing Data for: "/>
                                    <Run Text="{Binding DisplayName}"/>
                                </TextBlock>
                                <Border Height="1" Background="#444" Margin="0,5,0,10"/>

                                <TextBlock Text="Core Data" FontWeight="Bold" Margin="0,5,0,4"/>
                                <StackPanel Margin="0,0,0,6" Grid.IsSharedSizeScope="True">
                                    <Grid Margin="0,0,0,6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" SharedSizeGroup="LabelColumn" MinWidth="170" />
                                            <ColumnDefinition Width="120" SharedSizeGroup="ValueColumn" />
                                            <ColumnDefinition Width="*" SharedSizeGroup="InfoColumn" MinWidth="220" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="Best Lap Time (m:ss.fff):" VerticalAlignment="Center" Margin="0,0,10,0" />
                                        <TextBox Grid.Column="1" TextAlignment="Right" MinWidth="110">
                                            <TextBox.Text>
                                                <Binding Path="BestLapMsText"
                                                         Mode="TwoWay"
                                                         UpdateSourceTrigger="PropertyChanged"
                                                         ValidatesOnDataErrors="True"
                                                         NotifyOnValidationError="True">
                                                    <Binding.ValidationRules>
                                                        <local:LapTimeValidationRule />
                                                    </Binding.ValidationRules>
                                                </Binding>
                                            </TextBox.Text>
                                        </TextBox>
                                        <TextBlock Grid.Column="2" Margin="12,2,0,0" FontStyle="Italic" Foreground="#FF9AA0A6" Text="" />
                                    </Grid>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" SharedSizeGroup="LabelColumn" MinWidth="170" />
                                            <ColumnDefinition Width="120" SharedSizeGroup="ValueColumn" />
                                            <ColumnDefinition Width="*" SharedSizeGroup="InfoColumn" MinWidth="220" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0"
                                            Text="Pit Lane Loss (s):"
                                            Margin="0,0,10,0"
                                            VerticalAlignment="Center" />

                                        <TextBox Grid.Column="1"
                                             TextAlignment="Right"
                                             Padding="2,0,2,0"
                                             MinWidth="110"
                                             Text="{Binding PitLaneLossSecondsText,
                                                            Mode=TwoWay,
                                                            UpdateSourceTrigger=PropertyChanged,
                                                            ValidatesOnDataErrors=True,
                                                            NotifyOnValidationError=True}" />

                                        <Grid Grid.Column="2" Margin="12,0,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0">
                                                <TextBlock FontStyle="Italic" Foreground="#FF9AA0A6" TextWrapping="Wrap">
                                                    <Run Text="{Binding PitLaneLossSource, TargetNullValue=Manual}" />
                                                    <Run Text=": " />
                                                    <Run Text="{Binding PitLaneLossUpdatedUtc, StringFormat={}{0:yyyy-MM-dd HH:mm}}" />
                                                </TextBlock>

                                                <TextBlock FontStyle="Italic" Foreground="#FF9AA0A6" TextWrapping="Wrap">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Visibility" Value="Visible" />
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding PitLaneLossBlockedCandidateDisplay, Mode=OneWay}" Value="">
                                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                        <Run Text="{Binding PitLaneLossBlockedCandidateDisplay, Mode=OneWay}" />
                                                </TextBlock>
                                            </StackPanel>

                                            <CheckBox Grid.Column="1"
                                              Content="Locked"
                                              VerticalAlignment="Top"
                                              Margin="12,0,0,0"
                                              IsChecked="{Binding PitLaneLossLocked, Mode=TwoWay}" />
                                        </Grid>
                                    </Grid>


                                </StackPanel>

                                <!-- Dry Conditions Data -->
                                <TextBlock Text="Dry Conditions Data" FontWeight="Bold" Margin="0,10,0,4"/>

                                <StackPanel Margin="0,0,0,6" Grid.IsSharedSizeScope="True">
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" SharedSizeGroup="LabelColumn" MinWidth="170" />
                                            <ColumnDefinition Width="120" SharedSizeGroup="ValueColumn" />
                                            <ColumnDefinition Width="*" SharedSizeGroup="InfoColumn" MinWidth="220" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="Avg Lap Time (m:ss.fff):" Margin="0,0,10,0" VerticalAlignment="Center" />
                                        <TextBox Grid.Column="1" TextAlignment="Right" Width="120" MinWidth="110">
                                            <TextBox.Text>
                                                <Binding Path="AvgLapTimeDryText"
                                                         Mode="TwoWay"
                                                         UpdateSourceTrigger="PropertyChanged"
                                                         ValidatesOnDataErrors="True"
                                                         NotifyOnValidationError="True">
                                                    <Binding.ValidationRules>
                                                        <local:LapTimeValidationRule/>
                                                    </Binding.ValidationRules>
                                                </Binding>
                                            </TextBox.Text>
                                        </TextBox>
                                        <TextBlock Grid.Column="2" Text="{Binding DryLapTimeSampleCount, StringFormat=Sample: {0}}" Margin="12,0,0,0" VerticalAlignment="Center"/>
                                    </Grid>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" SharedSizeGroup="LabelColumn" MinWidth="170" />
                                            <ColumnDefinition Width="120" SharedSizeGroup="ValueColumn" />
                                            <ColumnDefinition Width="*" SharedSizeGroup="InfoColumn" MinWidth="220" />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,10,0" >
                                            <TextBlock Text="Fuel Burn (L/lap):" />
                                            <TextBlock Text="{Binding DryFuelSampleCount, StringFormat= Sample: {0}}" Margin="4,0,0,0" VerticalAlignment="Center"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" Margin="0,0,0,0">
                                            <Grid Margin="0,0,0,2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="60" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="ECO" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                                <TextBox Grid.Column="1" Text="{Binding MinFuelPerLapDryText, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" TextAlignment="Right" Width="60" VerticalAlignment="Center"/>
                                            </Grid>
                                            <Grid Margin="0,0,0,2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="60" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="AVG" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                                <TextBox Grid.Column="1" Text="{Binding AvgFuelPerLapDryText, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" TextAlignment="Right" Width="60" VerticalAlignment="Center"/>
                                            </Grid>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="60" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="MAX" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                                <TextBox Grid.Column="1" Text="{Binding MaxFuelPerLapDryText, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" TextAlignment="Right" Width="60" VerticalAlignment="Center"/>
                                            </Grid>
                                        </StackPanel>

                                        <StackPanel Grid.Column="2" Margin="12,0,0,0" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding FuelLastUpdatedText}" FontStyle="Italic" Foreground="#FF9AA0A6" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                                <!-- Wet Conditions Data -->
                                <TextBlock Text="Wet Conditions Data" FontWeight="Bold" Margin="0,10,0,4"/>

                                <StackPanel Margin="0,0,0,6" Grid.IsSharedSizeScope="True">
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" SharedSizeGroup="LabelColumn" MinWidth="170" />
                                            <ColumnDefinition Width="120" SharedSizeGroup="ValueColumn" />
                                            <ColumnDefinition Width="*" SharedSizeGroup="InfoColumn" MinWidth="220" />
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Text="Avg Lap Time (m:ss.fff):" Margin="0,0,10,0" VerticalAlignment="Center" />
                                        <TextBox Grid.Column="1" TextAlignment="Right" Width="120" MinWidth="110">
                                            <TextBox.Text>
                                                <Binding Path="AvgLapTimeWetText"
                                                         Mode="TwoWay"
                                                         UpdateSourceTrigger="PropertyChanged"
                                                         ValidatesOnDataErrors="True"
                                                         NotifyOnValidationError="True">
                                                    <Binding.ValidationRules>
                                                        <local:LapTimeValidationRule/>
                                                    </Binding.ValidationRules>
                                                </Binding>
                                            </TextBox.Text>
                                        </TextBox>
                                        <TextBlock Grid.Column="2" Text="{Binding WetLapTimeSampleCount, StringFormat=Sample: {0}}" Margin="12,0,0,0" VerticalAlignment="Center"/>
                                    </Grid>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" SharedSizeGroup="LabelColumn" MinWidth="170" />
                                            <ColumnDefinition Width="120" SharedSizeGroup="ValueColumn" />
                                            <ColumnDefinition Width="*" SharedSizeGroup="InfoColumn" MinWidth="220" />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,10,0">
                                            <TextBlock Text="Fuel Burn (L/lap):" />
                                            <TextBlock Text="{Binding WetFuelSampleCount, StringFormat= Sample: {0}}" Margin="4,0,0,0" VerticalAlignment="Center"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" Margin="0,0,0,0">
                                            <Grid Margin="0,0,0,2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="60" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="ECO" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                                <TextBox Grid.Column="1" Text="{Binding MinFuelPerLapWetText, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" TextAlignment="Right" Width="60" VerticalAlignment="Center"/>
                                            </Grid>
                                            <Grid Margin="0,0,0,2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="60" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="AVG" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                                <TextBox Grid.Column="1" Text="{Binding AvgFuelPerLapWetText, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" TextAlignment="Right" Width="60" VerticalAlignment="Center"/>
                                            </Grid>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="60" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="MAX" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                                <TextBox Grid.Column="1" Text="{Binding MaxFuelPerLapWetText, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" TextAlignment="Right" Width="60" VerticalAlignment="Center"/>
                                            </Grid>
                                        </StackPanel>

                                        <StackPanel Grid.Column="2" Margin="12,0,0,0" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding FuelLastUpdatedText}" FontStyle="Italic" Foreground="#FF9AA0A6" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                                <StackPanel Margin="0,10,0,0" Grid.IsSharedSizeScope="True">
                                    <TextBlock Text="Wet vs Dry Avg Deltas:" FontWeight="SemiBold" Margin="0,0,0,2" />
                                    <StackPanel Margin="5,0,0,0">
                                        <TextBlock Text="{Binding WetVsDryAvgLapDeltaText, StringFormat=Avg Pace at {0}}"  />
                                        <TextBlock Text="{Binding WetVsDryAvgFuelDeltaText, StringFormat=Avg Fuel Burn at {0}}" />
                                    </StackPanel>
                                </StackPanel>

                                <GroupBox Header="Pit Track Markers" Margin="0,12,0,0" DataContext="{Binding DataContext, RelativeSource={RelativeSource AncestorType=UserControl}}">
                                    <Grid Margin="8,6,8,8">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Stored Pit Entry %:" Margin="0,0,10,0" VerticalAlignment="Center"/>
                                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding StoredPitEntryPctText}" VerticalAlignment="Center"/>

                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Stored Pit Exit %:" Margin="0,4,10,0" VerticalAlignment="Center"/>
                                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding StoredPitExitPctText}" Margin="0,4,0,0" VerticalAlignment="Center"/>

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Last Updated (UTC):" Margin="0,4,10,0" VerticalAlignment="Center"/>
                                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding TrackMarkersLastUpdatedText}" Margin="0,4,0,0" VerticalAlignment="Center"/>

                                        <CheckBox Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" Content="Locked" Margin="0,6,6,0" IsChecked="{Binding TrackMarkersLocked, Mode=TwoWay}" />
                                        <Button Grid.Row="3" Grid.Column="2" Content="Reload markers" Command="{Binding ReloadTrackMarkersCommand}" Margin="0,6,0,0" ToolTip="Reload LalaLaunch.TrackMarkers.json from disk (for manual edits)." />
                                    </Grid>
                                </GroupBox>

                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </styles:SHTabItem>
            </TabControl>
        </DockPanel>
    </Grid>
</UserControl>
   
